<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线HTML编辑器</title>
    <!-- 引入必要的样式和脚本库 -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.min.js"></script>
    <style>
        /* 页面和编辑器的基础样式 */
        body, .editor, .preview {
            font-family: Arial, sans-serif;
            transition: background-color 0.5s, color 0.5s;
        }
        /* 容器布局 */
        .container {
            display: flex;
            justify-content: space-around;
            margin: 20px;
        }
        /* 编辑器和预览区样式 */
        .editor, .preview {
            width: 45%;
            border: 1px solid #ccc;
            padding: 20px;
            box-sizing: border-box;
        }
        /* 编辑器高度设置 */
        #codeEditor {
            height: 300px;
        }
        /* 预览区iframe样式 */
        iframe {
            width: 100%;
            height: 300px;
            border: none;
        }
        /* 深色主题样式 */
        body.dark-theme, .dark-theme .editor, .dark-theme .preview {
            background-color: #333;
            color: #fff;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="editor">
        <h2>编辑区</h2>
        <div id="codeEditor"></div>
    </div>
    <div class="preview">
        <h2>预览区</h2>
        <iframe id="codePreview" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
    </div>
</div>

<!-- 主题切换、保存和导入按钮 -->
<button id="themeToggle">切换深色模式</button>
<button id="saveButton">保存</button>
<button id="importButton">导入上次编辑的代码</button>
<button id="clearButton">清空代码</button>
    <span id="fileSizeDisplay">文件大小：0 B</span>
<script>
    // 初始化ACE编辑器并设置其主题和模式
    var editor = ace.edit("codeEditor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/html");
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setOption("wrap", true);
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    });

    /**
     * 更新预览区的HTML内容。
     * 监听编辑器内容的变化，并实时更新预览。
     */
    function updatePreview() {
        var code = editor.getValue();
        var previewFrame = document.getElementById('codePreview');
        var previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
        previewDoc.open();
        var parser = new DOMParser();
        var safeCode = parser.parseFromString('<!DOCTYPE html><html><head><style>' + code + '</style></head><body></body></html>', 'text/html').body.innerHTML;
        previewDoc.write(safeCode);
        previewDoc.close();
    }

    // 监听编辑器内容变化，实时更新预览
    editor.getSession().on('change', updatePreview);

    // 主题切换按钮点击事件处理函数
    document.getElementById('themeToggle').addEventListener('click', function() {
        document.body.classList.toggle('dark-theme');
        editor.setTheme(document.body.classList.contains('dark-theme') ? "ace/theme/terminal" : "ace/theme/chrome");
    });

    // 初始化时更新预览
    updatePreview();

    /**
     * 保存当前编辑器的内容到localStorage。
     * 用于保存用户的编辑状态，以便下次加载。
     */
    function saveCode() {
        try {
            localStorage.setItem('savedCode', editor.getValue());
        } catch (e) {
            console.error("保存代码时出错:", e);
        }
    }

    /**
     * 从localStorage导入之前保存的代码。
     * 用于加载用户上一次的编辑状态。
     */
    function importCode() {
        try {
            var savedCode = localStorage.getItem('savedCode');
            if (savedCode) {
                editor.setValue(savedCode, -1);
                updatePreview();
            }
        } catch (e) {
            console.error("导入代码时出错:", e);
        }
    }

    // 绑定保存和导入按钮的点击事件
    document.getElementById('saveButton').addEventListener('click', saveCode);
    document.getElementById('importButton').addEventListener('click', importCode);
    // 清空代码按钮点击事件处理函数
    document.getElementById('clearButton').addEventListener('click', function() {
            editor.setValue('', -1);
            updatePreview();
            updateFileSize(0);
        });

        // 更新文件大小显示
        function updateFileSize(size) {
            document.getElementById('fileSizeDisplay').innerText = `文件大小：${size} B`;
        }

        // 计算编辑器内容的字节大小
        function calculateFileSize() {
            var code = editor.getValue();
            var byteSize = new Blob([code]).size;
            return byteSize;
        }

        // 初始文件大小
        updateFileSize(calculateFileSize());

        // 监听编辑器内容变化，实时更新文件大小
        editor.getSession().on('change', function() {
            var newSize = calculateFileSize();
            updateFileSize(newSize);
        });
</script>
</body>
</html>
